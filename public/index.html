<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–°å¤§æ­£å±±ä¸œå¤§å­¦(é’å²›)ç»¿åŒ–ä½œæˆ˜å›¾</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="test-storage.js"></script>
  <script src="multi-device-sync.js"></script>
  <script>
    console.log('ğŸ”„ index.html å¼€å§‹åŠ è½½...');
    console.log('test-storage.js åŠ è½½çŠ¶æ€:', typeof window.testStorage);
    console.log('multi-device-sync.js åŠ è½½çŠ¶æ€:', typeof window.multiDeviceSync);
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#8b1e23', // çº¢è‰²ä¸»é¢˜
            secondary: '#00B42A',
            warning: '#e3783b', // æ©™è‰²
            danger: '#F53F3F',
            gray: {
              100: '#F2F3F5',
              200: '#E5E6EB',
              300: '#C9CDD4',
              400: '#86909C',
              500: '#4E5969',
              600: '#272E3B',
              700: '#1D2129',
            }
          },
          fontFamily: {
            // æ·»åŠ åæ–‡ä¸­å®‹å­—ä½“
            'stzhongsong': ['STZhongsong', 'SimSun', 'serif'],
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .watering-due {
        animation: pulse 2s infinite;
      }
      .svg-container {
        aspect-ratio: 16/9;
      }
      .drawing-cursor {
        cursor: crosshair;
      }
      .area-path {
        transition: all 0.3s ease;
      }
      .area-path:hover {
        filter: brightness(1.2);
        stroke-width: 3;
      }
    }

    @keyframes pulse {
      0% {
        filter: brightness(1);
      }
      50% {
        filter: brightness(1.5);
      }
      100% {
        filter: brightness(1);
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-100 text-gray-700 min-h-screen flex flex-col">
  <!-- é¡¶éƒ¨å¯¼èˆª - ä¿®æ”¹ä¸ºçº¢è‰²èƒŒæ™¯ -->
  <header class="bg-primary text-white shadow-md">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-3 flex-1 min-w-0">
        <!-- å¢å¤§äº†logoå°ºå¯¸ -->
        <img src="assets/ShanDa.png" alt="Logo" class="h-10 flex-shrink-0">
        <!-- ä½¿ç”¨åæ–‡ä¸­å®‹å­—ä½“ï¼Œå¢å¤§äº†å­—ä½“ï¼Œæ‰‹æœºç«¯è‡ªé€‚åº” -->
        <h1 class="text-2xl font-bold font-stzhongsong truncate md:text-2xl text-lg">æ–°å¤§æ­£å±±ä¸œå¤§å­¦(é’å²›)ç»¿åŒ–ä½œæˆ˜å›¾</h1>
      </div>
      <div class="flex items-center space-x-2 md:space-x-4 flex-shrink-0">
        <span id="current-date" class="text-xs md:text-sm hidden sm:block"></span>

                    <button id="refresh-btn" class="bg-white/20 hover:bg-white/30 transition-colors rounded px-2 md:px-3 py-1 text-xs md:text-sm flex items-center" title="åˆ·æ–°ç»¿åŒ–çŠ¶æ€æ•°æ®" aria-label="åˆ·æ–°çŠ¶æ€">
              <i class="fa fa-refresh mr-1"></i> <span class="hidden sm:inline">åˆ·æ–°çŠ¶æ€</span>
            </button>
            <button id="sync-btn" class="bg-white/20 hover:bg-white/30 transition-colors rounded px-2 md:px-3 py-1 text-xs md:text-sm flex items-center" title="åŒæ­¥ç»¿åŒ–æ•°æ®" aria-label="æ•°æ®åŒæ­¥">
              <i class="fa fa-exchange mr-1"></i> <span class="hidden sm:inline">æ•°æ®åŒæ­¥</span>
            </button>
      </div>
    </div>
  </header>

  <!-- ä¸»è¦å†…å®¹åŒº -->
  <main class="flex-grow container mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- å·¦ä¾§ï¼šç»¿åŒ–åŒºåŸŸåœ°å›¾ -->
      <div class="lg:col-span-2 bg-white rounded-lg shadow p-4">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold flex items-center">
            <i class="fa fa-map-o mr-2 text-warning"></i>å±±ä¸œå¤§å­¦é’å²›æ ¡åŒºç»¿åŒ–åœ°å›¾
            <span id="drawing-status" class="ml-3 text-sm bg-warning/20 text-warning px-2 py-1 rounded hidden">
              <i class="fa fa-pencil mr-1"></i>ç»˜åˆ¶æ¨¡å¼
            </span>
          </h2>
          <div class="flex space-x-2">
            <button id="draw-area" class="bg-gray-100 hover:bg-gray-200 transition-colors p-1 rounded flex items-center" title="å¼€å§‹ç»˜åˆ¶æ–°çš„ç»¿åŒ–åŒºåŸŸ" aria-label="ç»˜åˆ¶æ–°åŒºåŸŸ">
              <i class="fa fa-pencil"></i>
              <span class="ml-1 hidden sm:inline">ç»˜åˆ¶æ–°åŒºåŸŸ</span>
            </button>
            <button id="cancel-drawing" class="bg-gray-100 hover:bg-gray-200 transition-colors p-1 rounded hidden" title="å–æ¶ˆç»˜åˆ¶æ“ä½œ" aria-label="å–æ¶ˆç»˜åˆ¶">
              <i class="fa fa-times"></i>
              <span class="ml-1 hidden sm:inline">å–æ¶ˆç»˜åˆ¶</span>
            </button>
            <button id="confirm-drawing" class="bg-gray-100 hover:bg-gray-200 transition-colors p-1 rounded hidden" title="ç¡®è®¤ç»˜åˆ¶åŒºåŸŸ" aria-label="ç¡®å®šåŒºåŸŸ">
              <i class="fa fa-check"></i>
              <span class="ml-1 hidden sm:inline">ç¡®å®šåŒºåŸŸ</span>
            </button>

          </div>
        </div>
        
        <div class="svg-container bg-gray-50 rounded overflow-hidden border border-gray-200">
          <!-- å­¦æ ¡åœ°å›¾SVG -->
          <svg id="school-map" viewBox="0 0 1000 600" class="w-full h-full">
            <!-- å­¦æ ¡èƒŒæ™¯å›¾ -->
            <image id="school-bg" xlink:href="assets/SchoolMap.png" width="1000" height="600" preserveAspectRatio="xMidYMid slice" />
            
            <!-- ä¸´æ—¶ç»˜åˆ¶è·¯å¾„ -->
            <path id="temp-path" d="" fill="rgba(139, 195, 74, 0.3)" stroke="#4CAF50" stroke-width="2" stroke-dasharray="5,5" class="hidden" />
            
            <!-- å›¾ä¾‹ -->
            <g transform="translate(20, 480)">
              <rect x="0" y="0" width="120" height="100" fill="white" stroke="#999" rx="5" />
              <text x="60" y="20" text-anchor="middle" font-weight="bold">å›¾ä¾‹</text>
              
              <circle cx="15" cy="45" r="8" fill="#8BC34A" />
              <text x="35" y="49" font-size="12">æ­£å¸¸</text>
              
              <circle cx="15" cy="65" r="8" fill="#FF7D00" />
              <text x="35" y="69" font-size="12">éœ€è¦æµ‡æ°´</text>
              
              <circle cx="15" cy="85" r="8" fill="#F53F3F" />
              <text x="35" y="89" font-size="12">å·²é€¾æœŸ</text>
            </g>
          </svg>
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šç»¿åŒ–ç®¡ç†é¢æ¿ -->
      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="text-lg font-semibold mb-4 flex items-center">
          <i class="fa fa-tasks mr-2 text-warning"></i>ç»¿åŒ–ç®¡ç†
        </h2>
        
        <!-- ç»¿åŒ–åŒºåŸŸé€‰æ‹©å™¨ -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-600 mb-1">é€‰æ‹©ç»¿åŒ–åŒºåŸŸ</label>
          <div id="area-buttons" class="grid grid-cols-3 gap-2">
          </div>
        </div>
        
        <!-- å½“å‰é€‰ä¸­åŒºåŸŸä¿¡æ¯ -->
        <div id="area-details" class="bg-gray-50 rounded p-3 border border-gray-200 mb-4">
          <h3 class="text-base font-medium mb-2" id="area-name">æœªé€‰æ‹©åŒºåŸŸ</h3>
          
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">ä¸Šæ¬¡æµ‡æ°´:</span>
              <span class="text-sm font-medium" id="last-watered">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">æµ‡æ°´é¢‘ç‡:</span>
              <span class="text-sm font-medium">
                <select id="watering-frequency" class="bg-white border border-gray-300 rounded px-2 py-1 text-sm" title="é€‰æ‹©æµ‡æ°´é¢‘ç‡" aria-label="æµ‡æ°´é¢‘ç‡é€‰æ‹©">
                  <option value="0">æ¯æœˆ 0 æ¬¡</option>
                  <option value="1">æ¯æœˆ 1 æ¬¡</option>
                  <option value="2">æ¯æœˆ 2 æ¬¡</option>
                  <option value="3">æ¯æœˆ 3 æ¬¡</option>
                  <option value="4">æ¯æœˆ 4 æ¬¡</option>
                  <option value="5">æ¯æœˆ 5 æ¬¡</option>
                  <option value="6">æ¯æœˆ 6 æ¬¡</option>
                </select>
              </span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">ä¸‹æ¬¡æµ‡æ°´:</span>
              <span class="text-sm font-medium" id="next-watering">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">çŠ¶æ€:</span>
              <span class="text-sm font-medium" id="area-status">-</span>
            </div>
          </div>
        </div>
        
                <!-- æ“ä½œæŒ‰é’® - æ”¹ä¸ºæ©™è‰² -->
        <div class="flex space-x-3">
          <button id="record-watering" class="flex-1 bg-warning hover:bg-warning/90 transition-colors text-white py-2 px-4 rounded flex items-center justify-center" title="è®°å½•å½“å‰åŒºåŸŸçš„æµ‡æ°´ä¿¡æ¯" aria-label="è®°å½•æµ‡æ°´">
            <i class="fa fa-check-circle mr-1"></i> è®°å½•æµ‡æ°´
          </button>
          <button id="delete-area" class="bg-danger hover:bg-danger/90 transition-colors text-white py-2 px-4 rounded flex items-center justify-center" title="åˆ é™¤å½“å‰é€‰ä¸­çš„ç»¿åŒ–åŒºåŸŸ" aria-label="åˆ é™¤åŒºåŸŸ">
            <i class="fa fa-trash mr-1"></i> åˆ é™¤åŒºåŸŸ
          </button>
        </div>
        
        <!-- è¿‘æœŸæµ‡æ°´è®°å½• -->
        <div class="mt-6">
          <h3 class="text-base font-medium mb-2 flex items-center">
            <i class="fa fa-history mr-2 text-warning"></i>æµ‡æ°´è®°å½•
          </h3>
          <div id="watering-records" class="space-y-2 max-h-40 overflow-y-auto pr-1">
            <div class="text-center py-4 text-gray-500 text-sm">æš‚æ— æµ‡æ°´è®°å½•</div>
          </div>
          
          <!-- æµ‡æ°´è®°å½•åˆ†é¡µæ§ä»¶ -->
          <div id="watering-pagination" class="flex justify-between items-center mt-2 hidden">
            <div id="watering-page-info" class="text-sm text-gray-600">ç¬¬ <span id="watering-current-page">1</span> é¡µï¼Œå…± <span id="watering-total-pages">1</span> é¡µ</div>
            <div class="flex space-x-2">
              <button id="watering-prev-page" class="bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded disabled:opacity-50 text-xs" disabled>
                <i class="fa fa-chevron-left"></i>
              </button>
              <button id="watering-next-page" class="bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded disabled:opacity-50 text-xs" disabled>
                <i class="fa fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ç»¿åŒ–ä»»åŠ¡æ—¥å† -->
    <div class="mt-6 bg-white rounded-lg shadow p-4">
      <h2 class="text-lg font-semibold mb-4 flex items-center">
        <i class="fa fa-calendar mr-2 text-warning"></i>ç»¿åŒ–ä»»åŠ¡æ—¥å†
      </h2>
              <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr>
                <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ—¥æœŸ</th>
                <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åŒºåŸŸ</th>
                <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä»»åŠ¡</th>
                <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
              </tr>
            </thead>
            <tbody id="calendar-body" class="bg-white divide-y divide-gray-200">
              <tr>
                <td colspan="4" class="px-3 py-4 text-center text-sm text-gray-500">æš‚æ— ç»¿åŒ–ä»»åŠ¡</td>
              </tr>
            </tbody>
          </table>
        </div>
      
      <!-- åˆ†é¡µæ§ä»¶ -->
      <div id="pagination-controls" class="flex justify-between items-center mt-4">
        <div id="page-info" class="text-sm text-gray-600">ç¬¬ <span id="current-page">1</span> é¡µï¼Œå…± <span id="total-pages">1</span> é¡µ</div>
        <div class="flex space-x-2">
          <button id="prev-page" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded disabled:opacity-50" disabled>
            <i class="fa fa-chevron-left"></i>
          </button>
          <button id="next-page" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded disabled:opacity-50" disabled>
            <i class="fa fa-chevron-right"></i>
          </button>
        </div>
      </div>
      
      <!-- æµ‡æ°´è¯´æ˜ -->
      <div class="mt-4 pt-3 border-t border-gray-100">
        <p class="text-xs text-gray-500 italic flex items-center">
          <i class="fa fa-info-circle mr-1 text-blue-400"></i>
          æ³¨ï¼š11æœˆè‡³ç¿Œå¹´3æœˆä¸­æ—¬æ€»æµ‡æ°´ä¸¤æ¬¡ï¼ˆå°å†»æ°´ã€è¿”é’æ°´ï¼‰
        </p>
      </div>
    </div>
  </main>

  <!-- é¡µè„š - ä¿®æ”¹ä¸ºçº¢è‰²èƒŒæ™¯å¹¶ä½¿ç”¨çŸ¢é‡å›¾ -->
  <footer class="bg-primary py-6 mt-6">
    <div class="container mx-auto px-4 flex justify-center">
      <!-- ä½¿ç”¨çŸ¢é‡å›¾æ›¿æ¢æ–‡å­— -->
      <img src="assets/Result.png" alt="Footer Logo" class="h-10">
    </div>
  </footer>

  <!-- æ¨¡æ€æ¡† - è®°å½•æµ‡æ°´ -->
  <div id="watering-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">è®°å½•æµ‡æ°´</h3>
        <button id="close-modal" class="text-gray-400 hover:text-gray-500">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <form id="watering-form">
        <div class="mb-4">
          <label for="modal-area" class="block text-sm font-medium text-gray-700 mb-1">åŒºåŸŸ</label>
          <input type="text" id="modal-area" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-warning/50" readonly aria-label="é€‰ä¸­çš„ç»¿åŒ–åŒºåŸŸåç§°">
        </div>
        
        <div class="mb-4">
          <label for="modal-date" class="block text-sm font-medium text-gray-700 mb-1">æ—¥æœŸ</label>
          <input type="text" id="modal-date" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-warning/50" readonly aria-label="æµ‡æ°´æ—¥æœŸ">
        </div>
        
        <div class="mb-4">
          <label for="modal-person" class="block text-sm font-medium text-gray-700 mb-1">è´Ÿè´£äºº<span class="text-danger">*</span></label>
          <input type="text" id="modal-person" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-warning/50" placeholder="è¾“å…¥è´Ÿè´£äººå§“å" required aria-label="æµ‡æ°´è´Ÿè´£äººå§“å">
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">å¤‡æ³¨<span class="text-danger">*</span></label>
          <textarea id="modal-notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-warning/50" placeholder="è¾“å…¥å¤‡æ³¨ä¿¡æ¯" required></textarea>
        </div>
        
        <!-- æ·»åŠ å€’è®¡æ—¶æç¤º -->
        <div id="countdown-tip" class="mt-4 text-sm text-gray-600 hidden">
          è¯·ç¡®è®¤ä¿¡æ¯ï¼Œ<span id="countdown-seconds">3</span>ç§’åè‡ªåŠ¨æäº¤...
        </div>
        
        <div class="flex space-x-3 mt-4">
          <button type="button" id="cancel-watering" class="flex-1 bg-gray-200 hover:bg-gray-300 transition-colors text-gray-700 py-2 px-4 rounded">å–æ¶ˆ</button>
          <button type="submit" class="flex-1 bg-warning hover:bg-warning/90 transition-colors text-white py-2 px-4 rounded" id="submit-watering">ä¿å­˜è®°å½•</button>
        </div>
      </form>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡† - åˆ é™¤ç¡®è®¤ -->
  <div id="delete-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">åˆ é™¤åŒºåŸŸ</h3>
        <button id="close-delete-modal" class="text-gray-400 hover:text-gray-500">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <div class="mb-4">
        <p class="text-gray-700 mb-2">ç¡®å®šè¦åˆ é™¤åŒºåŸŸ <span id="delete-area-name" class="font-semibold"></span> å—ï¼Ÿ</p>
        <p class="text-gray-700 mb-4">æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼Œæ‰€æœ‰ç›¸å…³æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚</p>
        <label class="block text-sm font-medium text-gray-700 mb-1">è¯·è¾“å…¥åˆ é™¤å¯†ç </label>
        <input type="password" id="delete-password" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-warning/50" placeholder="è¾“å…¥å¯†ç ">
        <p id="password-error" class="text-red-500 text-sm mt-1 hidden">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</p>
      </div>
      
      <div class="flex space-x-3">
        <button type="button" id="cancel-delete" class="flex-1 bg-gray-200 hover:bg-gray-300 transition-colors text-gray-700 py-2 px-4 rounded">å–æ¶ˆ</button>
        <button type="button" id="confirm-delete" class="flex-1 bg-danger hover:bg-danger/90 transition-colors text-white py-2 px-4 rounded">ç¡®è®¤åˆ é™¤</button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡† - ç»˜åˆ¶åŒºåŸŸå¯†ç  -->
  <div id="drawing-password-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">ç»˜åˆ¶æ–°åŒºåŸŸ</h3>
        <button id="close-drawing-modal" class="text-gray-400 hover:text-gray-500">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <div class="mb-4">
        <p class="text-gray-700 mb-4">è¯·è¾“å…¥å¯†ç ä»¥å¼€å§‹ç»˜åˆ¶æ–°åŒºåŸŸ</p>
        <label class="block text-sm font-medium text-gray-700 mb-1">ç»˜åˆ¶å¯†ç </label>
        <input type="password" id="drawing-password" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-warning/50" placeholder="è¾“å…¥å¯†ç ">
        <p id="drawing-password-error" class="text-red-500 text-sm mt-1 hidden">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</p>
      </div>
      
      <div class="flex space-x-3">
        <button type="button" id="cancel-drawing-modal" class="flex-1 bg-gray-200 hover:bg-gray-300 transition-colors text-gray-700 py-2 px-4 rounded">å–æ¶ˆ</button>
        <button type="button" id="confirm-drawing-modal" class="flex-1 bg-warning hover:bg-warning/90 transition-colors text-white py-2 px-4 rounded">ç¡®è®¤</button>
      </div>
    </div>
  </div>

  <script>
    // ç»¿åŒ–åŒºåŸŸæ•°æ®ï¼ˆåˆå§‹ä¸ºç©ºï¼‰
    let greenAreas = {};
    // å½“å‰é€‰ä¸­çš„åŒºåŸŸ
    let selectedArea = null;
    // ç»˜åˆ¶çŠ¶æ€
    let isDrawing = false;
    let drawingPoints = [];
    // è‡ªå®šä¹‰åŒºåŸŸè®¡æ•°å™¨ï¼ˆä»aå¼€å§‹ï¼‰
    let nextAreaLetter = 'a';
    // å€’è®¡æ—¶å®šæ—¶å™¨
    let countdownTimer = null;

    // åˆ†é¡µç›¸å…³å˜é‡
    let currentPage = 1;
    const tasksPerPage = 5;
    let allTasks = [];
    
    // æµ‡æ°´è®°å½•åˆ†é¡µå˜é‡
    let wateringCurrentPage = 1;
    const wateringPerPage = 5;

    // å­˜å‚¨é”®åå¸¸é‡
    const STORAGE_KEYS = {
      GREEN_AREAS: 'campus_greening_areas',
      SELECTED_AREA: 'campus_greening_selected_area',
      NEXT_AREA_LETTER: 'campus_greening_next_area_letter',
      CURRENT_PAGE: 'campus_greening_current_page',
      WATERING_CURRENT_PAGE: 'campus_greening_watering_current_page'
    };

    // DOM å…ƒç´ 
    const areaBtnsContainer = document.getElementById("area-buttons");
    const areaDetails = document.getElementById("area-details");
    const areaNameEl = document.getElementById("area-name");
    const areaSizeEl = document.getElementById("area-size");
    const lastWateredEl = document.getElementById("last-watered");
    const nextWateringEl = document.getElementById("next-watering");
    const areaStatusEl = document.getElementById("area-status");
    const wateringFrequencyEl = document.getElementById("watering-frequency");
    const recordWateringBtn = document.getElementById("record-watering");
    const wateringModal = document.getElementById("watering-modal");
    const closeModalBtn = document.getElementById("close-modal");
    const cancelWateringBtn = document.getElementById("cancel-watering");
    const wateringForm = document.getElementById("watering-form");
    const modalAreaEl = document.getElementById("modal-area");
    const modalDateEl = document.getElementById("modal-date");
    const modalPersonEl = document.getElementById("modal-person");
    const modalNotesEl = document.getElementById("modal-notes");
    const currentDateEl = document.getElementById("current-date");
    const refreshBtn = document.getElementById("refresh-btn");
    const schoolMap = document.getElementById("school-map");
    const drawAreaBtn = document.getElementById("draw-area");
    const cancelDrawingBtn = document.getElementById("cancel-drawing");
    const confirmDrawingBtn = document.getElementById("confirm-drawing");
    const drawingStatus = document.getElementById("drawing-status");
    const tempPath = document.getElementById("temp-path");
    const deleteAreaBtn = document.getElementById("delete-area");
    const wateringRecords = document.getElementById("watering-records");
    const calendarBody = document.getElementById("calendar-body");
    const prevPageBtn = document.getElementById("prev-page");
    const nextPageBtn = document.getElementById("next-page");
    const currentPageEl = document.getElementById("current-page");
    const totalPagesEl = document.getElementById("total-pages");
    
    // åˆ é™¤æ¨¡æ€æ¡†å…ƒç´ 
    const deleteModal = document.getElementById("delete-modal");
    const closeDeleteModalBtn = document.getElementById("close-delete-modal");
    const cancelDeleteBtn = document.getElementById("cancel-delete");
    const confirmDeleteBtn = document.getElementById("confirm-delete");
    const deleteAreaNameEl = document.getElementById("delete-area-name");
    const deletePasswordEl = document.getElementById("delete-password");
    const passwordErrorEl = document.getElementById("password-error");
    
    // ç»˜åˆ¶å¯†ç æ¨¡æ€æ¡†å…ƒç´ 
    const drawingPasswordModal = document.getElementById("drawing-password-modal");
    const closeDrawingModalBtn = document.getElementById("close-drawing-modal");
    const cancelDrawingModalBtn = document.getElementById("cancel-drawing-modal");
    const confirmDrawingModalBtn = document.getElementById("confirm-drawing-modal");
    const drawingPasswordEl = document.getElementById("drawing-password");
    const drawingPasswordErrorEl = document.getElementById("drawing-password-error");
    
    // æµ‡æ°´è®°å½•åˆ†é¡µå…ƒç´ 
    const wateringPagination = document.getElementById("watering-pagination");
    const wateringPrevPageBtn = document.getElementById("watering-prev-page");
    const wateringNextPageBtn = document.getElementById("watering-next-page");
    const wateringCurrentPageEl = document.getElementById("watering-current-page");
    const wateringTotalPagesEl = document.getElementById("watering-total-pages");

    // æ–°å¢å…ƒç´ 
    const countdownTip = document.getElementById("countdown-tip");
    const countdownSeconds = document.getElementById("countdown-seconds");
    const submitWateringBtn = document.getElementById("submit-watering");

    // ===== æ•°æ®ä¿å­˜æ£€æŸ¥æ¸…å• =====
    // ä»¥ä¸‹æ‰€æœ‰æ•°æ®ä¿®æ”¹æ“ä½œéƒ½å¿…é¡»è°ƒç”¨ saveData():
    // 
    // 1. åŒºåŸŸé€‰æ‹©: selectArea() -> saveData() âœ“
    // 2. æµ‡æ°´é¢‘ç‡ä¿®æ”¹: wateringFrequencyEl.onchange -> saveData() âœ“
    // 3. æµ‡æ°´è®°å½•åˆ†é¡µ: goToWateringPrevPage/goToWateringNextPage -> saveData() âœ“
    // 4. æ–°å¢åŒºåŸŸ: confirmDrawingBtn -> saveData() âœ“
    // 5. åˆ é™¤åŒºåŸŸ: performDeleteArea() -> saveData() âœ“
    // 6. è®°å½•æµ‡æ°´: wateringForm.submit -> saveData() âœ“
    // 7. ä»»åŠ¡æ—¥å†æ›´æ–°: updateCalendar() -> saveData() âœ“
    // 8. æµ‡æ°´è®°å½•æ›´æ–°: updateWateringRecords() -> saveData() âœ“
    // 9. åŒºåŸŸæŒ‰é’®æ›´æ–°: updateAreaButtons() -> saveData() âœ“
    // 10. è‡ªåŠ¨ä¿å­˜: setInterval -> saveData() âœ“
    // 11. é¡µé¢å¸è½½: beforeunload -> saveData() âœ“
    // 12. æ•°æ®å¤‡ä»½: backupData() -> sessionStorage âœ“
    //
    // æ•°æ®ä¿®æ”¹ç‚¹æ£€æŸ¥:
    // - greenAreas[areaName] = {...} âœ“ (æ–°å¢åŒºåŸŸ)
    // - greenAreas[selectedArea].wateringFrequency = value âœ“ (ä¿®æ”¹é¢‘ç‡)
    // - greenAreas[area].lastWatered = date âœ“ (è®°å½•æµ‡æ°´)
    // - greenAreas[area].records.unshift({...}) âœ“ (æ·»åŠ è®°å½•)
    // - delete greenAreas[selectedArea] âœ“ (åˆ é™¤åŒºåŸŸ)
    // - selectedArea = area âœ“ (é€‰æ‹©åŒºåŸŸ)
    // - nextAreaLetter = nextLetter âœ“ (æ›´æ–°å­—æ¯)
    // ================================

    // ä¿å­˜æ•°æ®
    function saveData() {
      try {
        const dataToSave = {
          greenAreas: greenAreas,
          selectedArea: selectedArea || '',
          nextAreaLetter: nextAreaLetter,
          currentPage: currentPage,
          wateringCurrentPage: wateringCurrentPage
        };
        
        // ä½¿ç”¨ç®€åŒ–çš„å­˜å‚¨ç³»ç»Ÿ
        if (window.testStorage) {
          const success = testStorage.saveData(dataToSave);
          if (success) {
            console.log('âœ… æ•°æ®ä¿å­˜æˆåŠŸ');
          } else {
            console.error('âŒ æ•°æ®ä¿å­˜å¤±è´¥');
          }
        } else {
          console.error('âŒ å­˜å‚¨ç³»ç»Ÿæœªåˆå§‹åŒ–');
        }
      } catch (error) {
        console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
      }
    }

    // åŠ è½½æ•°æ®
    function loadData() {
      try {
        // é¦–å…ˆå°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        if (window.testStorage) {
          const data = testStorage.loadData();
          if (data && Object.keys(data.greenAreas || {}).length > 0) {
            greenAreas = data.greenAreas || {};
            selectedArea = data.selectedArea || '';
            nextAreaLetter = data.nextAreaLetter || 'A';
            currentPage = data.currentPage || 1;
            wateringCurrentPage = data.wateringCurrentPage || 1;
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„æ•°æ®æ˜¯å¦åŒ…å«records
            let hasRecords = false;
            Object.keys(greenAreas).forEach(areaName => {
              if (greenAreas[areaName].records && greenAreas[areaName].records.length > 0) {
                hasRecords = true;
              }
            });
            
            if (!hasRecords) {
              console.log('âš ï¸ æœ¬åœ°å­˜å‚¨æ•°æ®ç¼ºå°‘recordsï¼Œä»JSONæ–‡ä»¶é‡æ–°åŠ è½½');
              return loadFromJsonFile();
            }
            
            console.log('âœ… ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®æˆåŠŸ');
            return Promise.resolve(true);
          }
        }
        
        // å¦‚æœæœ¬åœ°å­˜å‚¨æ²¡æœ‰æ•°æ®ï¼Œä»JSONæ–‡ä»¶åŠ è½½
        console.log('âš ï¸ æœ¬åœ°å­˜å‚¨æ— æ•°æ®ï¼Œä»JSONæ–‡ä»¶åŠ è½½');
        return loadFromJsonFile();
        
      } catch (error) {
        console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
        return Promise.resolve(false);
      }
    }

    // ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®
    function loadFromJsonFile() {
      return fetch('assets/green-area.json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data && data.greenAreas) {
            greenAreas = data.greenAreas;
            selectedArea = data.selectedArea || '';
            nextAreaLetter = data.nextAreaLetter || 'A';
            currentPage = data.currentPage || 1;
            wateringCurrentPage = data.wateringCurrentPage || 1;
            
            // ç«‹å³ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveData();
            
            console.log('âœ… ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®æˆåŠŸå¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
            return true;
          } else {
            console.log('âš ï¸ JSONæ–‡ä»¶æ•°æ®æ ¼å¼æ— æ•ˆ');
            return false;
          }
        })
        .catch(error => {
          console.error('åŠ è½½JSONæ–‡ä»¶å¤±è´¥:', error);
          return false;
        });
    }







    // åˆå§‹åŒ–
    document.addEventListener("DOMContentLoaded", function() {
      // è®¾ç½®å½“å‰æ—¥æœŸ
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
      currentDateEl.textContent = now.toLocaleDateString('zh-CN', options);
      
      // å°è¯•åŠ è½½ä¿å­˜çš„æ•°æ®
      loadData().then(dataLoaded => {
        // éªŒè¯åŠ è½½çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ
        const hasValidData = dataLoaded && 
                            Object.keys(greenAreas).length > 0 && 
                            typeof greenAreas === 'object';
        
        if (hasValidData) {
          console.log('æ•°æ®æœ‰æ•ˆï¼Œé‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸ');
          redrawAllAreas();
        } else {
          console.log('æ•°æ®æ— æ•ˆæˆ–ä¸ºç©ºï¼Œä»JSONæ–‡ä»¶åŠ è½½æ•°æ®');
          // å¦‚æœæœ¬åœ°å­˜å‚¨æ²¡æœ‰æ•°æ®ï¼Œä»JSONæ–‡ä»¶åŠ è½½
          loadFromJsonFile().then(success => {
            if (success) {
              console.log('ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®æˆåŠŸï¼Œé‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸ');
              redrawAllAreas();
            } else {
              console.log('æ— æ³•åŠ è½½æ•°æ®ï¼Œä½¿ç”¨ç©ºæ•°æ®åˆå§‹åŒ–');
              greenAreas = {};
              selectedArea = '';
              nextAreaLetter = 'A';
              currentPage = 1;
              wateringCurrentPage = 1;
            }
            // åˆå§‹åŒ–åœ°å›¾çŠ¶æ€
            updateAreaButtons();
            updateCalendar();
          });
          return; // æå‰è¿”å›ï¼Œé¿å…é‡å¤åˆå§‹åŒ–
        }
        
        // åˆå§‹åŒ–åœ°å›¾çŠ¶æ€
        updateAreaButtons();
        updateCalendar();
      });
      
      // æ·»åŠ åˆ†é¡µäº‹ä»¶ç›‘å¬
      prevPageBtn.addEventListener('click', goToPrevPage);
      nextPageBtn.addEventListener('click', goToNextPage);
      
      // æµ‡æ°´è®°å½•åˆ†é¡µäº‹ä»¶ç›‘å¬
      wateringPrevPageBtn.addEventListener('click', goToWateringPrevPage);
      wateringNextPageBtn.addEventListener('click', goToWateringNextPage);
      
      // åˆ é™¤æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
      closeDeleteModalBtn.addEventListener('click', () => deleteModal.classList.add('hidden'));
      cancelDeleteBtn.addEventListener('click', () => deleteModal.classList.add('hidden'));
      confirmDeleteBtn.addEventListener('click', performDeleteArea);
      
      // ç»˜åˆ¶å¯†ç æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
      closeDrawingModalBtn.addEventListener('click', () => drawingPasswordModal.classList.add('hidden'));
      cancelDrawingModalBtn.addEventListener('click', () => drawingPasswordModal.classList.add('hidden'));
      confirmDrawingModalBtn.addEventListener('click', verifyDrawingPassword);
    });

    // é‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸ
    function redrawAllAreas() {
      // æ¸…é™¤ç°æœ‰çš„åŒºåŸŸè·¯å¾„
      document.querySelectorAll('.area-path').forEach(path => {
        path.remove();
      });

      // é‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸ
      Object.entries(greenAreas).forEach(([areaName, areaData]) => {
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", areaData.path);
        path.setAttribute("fill", "rgba(139, 195, 74, 0.4)");
        path.setAttribute("stroke", "#4CAF50");
        path.setAttribute("stroke-width", "2");
        path.setAttribute("class", "area-path");
        path.setAttribute("id", `area-${areaName}`);
        path.addEventListener('click', () => selectArea(areaName));
        schoolMap.insertBefore(path, tempPath);
      });

      // æ›´æ–°æ‰€æœ‰åŒºåŸŸçš„é¢œè‰²çŠ¶æ€
      Object.keys(greenAreas).forEach(areaName => {
        const areaData = greenAreas[areaName];
        const lastWateredDate = new Date(areaData.lastWatered);
        const now = new Date();
        let nextWateringDate = new Date(lastWateredDate);
        if (parseInt(areaData.wateringFrequency) > 0) {
          const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
          const interval = Math.round(daysInMonth / parseInt(areaData.wateringFrequency));
          nextWateringDate = new Date(lastWateredDate.getTime() + interval * 24 * 60 * 60 * 1000);
        } else {
          nextWateringDate = null;
        }
        let statusText;
        if (parseInt(areaData.wateringFrequency) === 0) {
          statusText = 'æ­£å¸¸';
        } else {
          const nextDateStr = nextWateringDate ? nextWateringDate.toISOString().split('T')[0] : null;
          const todayStr = now.toISOString().split('T')[0];
          
          // è®¡ç®—å¤©æ•°å·®
          const today = new Date(todayStr);
          const nextDate = nextDateStr ? new Date(nextDateStr) : null;
          const daysDiff = nextDate ? Math.floor((nextDate - today) / (1000 * 60 * 60 * 24)) : 0;
          
          if (nextDateStr < todayStr) {
            statusText = 'å·²é€¾æœŸ';
          } else if (daysDiff <= 3 && daysDiff >= -1) { // å‰å3å¤©å†…éƒ½ç®—éœ€è¦æµ‡æ°´
            statusText = 'éœ€è¦æµ‡æ°´';
          } else {
            statusText = 'æ­£å¸¸';
          }
        }
        console.log(`åŒºåŸŸ ${areaName} çŠ¶æ€: ${statusText}, æµ‡æ°´é¢‘ç‡: ${areaData.wateringFrequency}, ä¸Šæ¬¡æµ‡æ°´: ${areaData.lastWatered}`);
        updateAreaColor(areaName, statusText);
      });

      // é€‰æ‹©ä¿å­˜çš„åŒºåŸŸæˆ–ç¬¬ä¸€ä¸ªåŒºåŸŸ
      if (selectedArea && greenAreas[selectedArea]) {
        selectArea(selectedArea);
      } else if (Object.keys(greenAreas).length > 0) {
        selectArea(Object.keys(greenAreas)[0]);
      }
    }



    // æ›´æ–°åŒºåŸŸæŒ‰é’®
    function updateAreaButtons() {
      areaBtnsContainer.innerHTML = '';
      const areas = Object.keys(greenAreas).sort();
      
      if (areas.length === 0) {
        areaBtnsContainer.innerHTML = '<div class="col-span-3 text-center py-4 text-gray-500 text-sm">æš‚æ— ç»¿åŒ–åŒºåŸŸï¼Œè¯·ç‚¹å‡»"ç»˜åˆ¶æ–°åŒºåŸŸ"å¼€å§‹</div>';
        return;
      }
      
      areas.forEach(area => {
        const btn = document.createElement('button');
        btn.classList.add('area-btn', 'flex-1', 'py-2', 'px-3', 'rounded');
        if (area === selectedArea) {
          btn.classList.add('bg-primary', 'text-white');
        } else {
          btn.classList.add('bg-gray-200', 'hover:bg-gray-300', 'transition-colors');
        }
        btn.dataset.area = area;
        btn.textContent = area;
        btn.addEventListener('click', () => selectArea(area));
        areaBtnsContainer.appendChild(btn);
      });
      
      // ä¿å­˜æ•°æ®
      saveData();
    }

    // é€‰æ‹©åŒºåŸŸ
    function selectArea(area) {
      selectedArea = area;
      updateAreaButtons();
      updateAreaDetails();
      highlightArea(area);
      
      // ä¿å­˜æ•°æ®
      saveData();
    }

    // é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„åŒºåŸŸ
    function highlightArea(area) {
      // ç§»é™¤æ‰€æœ‰åŒºåŸŸçš„é«˜äº®çŠ¶æ€
      document.querySelectorAll('.area-path').forEach(path => {
        path.classList.remove('selected-area');
        // ä¸é‡ç½®strokeé¢œè‰²ï¼Œä¿æŒçŠ¶æ€é¢œè‰²
      });
      
      // é«˜äº®é€‰ä¸­çš„åŒºåŸŸ - ä½¿ç”¨æ›´ç²—çš„è¾¹æ¡†
      const selectedPath = document.getElementById(`area-${area}`);
      if (selectedPath) {
        selectedPath.classList.add('selected-area');
        selectedPath.setAttribute('stroke-width', '4'); // å¢åŠ è¾¹æ¡†å®½åº¦è¡¨ç¤ºé€‰ä¸­
      }
    }

    // æ›´æ–°åŒºåŸŸè¯¦æƒ…
    function updateAreaDetails() {
      if (!selectedArea) {
        areaNameEl.textContent = "æœªé€‰æ‹©åŒºåŸŸ";
        lastWateredEl.textContent = "-";
        nextWateringEl.textContent = "-";
        areaStatusEl.textContent = "-";
        areaStatusEl.className = "text-sm font-medium";
        wateringRecords.innerHTML = '<div class="text-center py-4 text-gray-500 text-sm">æš‚æ— æµ‡æ°´è®°å½•</div>';
        wateringPagination.classList.add('hidden');
        return;
      }
      
      const areaData = greenAreas[selectedArea];
      areaNameEl.textContent = `${selectedArea} è¯¦æƒ…`;
      lastWateredEl.textContent = areaData.lastWatered;
      wateringFrequencyEl.value = areaData.wateringFrequency;
      
      // è®¡ç®—ä¸‹æ¬¡æµ‡æ°´æ—¥æœŸ
      const lastWateredDate = new Date(areaData.lastWatered);
      const now = new Date();
      
      // æ ¹æ®æµ‡æ°´é¢‘ç‡è®¡ç®—ä¸‹æ¬¡æµ‡æ°´æ—¥æœŸ
      let nextWateringDate = new Date(lastWateredDate);
      
      if (parseInt(areaData.wateringFrequency) > 0) {
        const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
        const interval = Math.round(daysInMonth / parseInt(areaData.wateringFrequency));
        nextWateringDate = new Date(lastWateredDate.getTime() + interval * 24 * 60 * 60 * 1000);
      } else {
        // å¦‚æœæµ‡æ°´é¢‘ç‡ä¸º0ï¼Œåˆ™æ²¡æœ‰ä¸‹æ¬¡æµ‡æ°´æ—¥æœŸ
        nextWateringDate = null;
      }
      
      // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
      areaStatusEl.className = "text-sm font-medium";
      
      let statusText;
      if (parseInt(areaData.wateringFrequency) === 0) {
        nextWateringEl.textContent = 'æ— éœ€æµ‡æ°´';
        statusText = 'æ­£å¸¸';
      } else {
        // åªæ¯”è¾ƒæ—¥æœŸéƒ¨åˆ†
        const nextDateStr = nextWateringDate ? nextWateringDate.toISOString().split('T')[0] : null;
        const todayStr = now.toISOString().split('T')[0];
        
        // è®¡ç®—å‰ä¸€å¤©å’Œåä¸€å¤©çš„æ—¥æœŸ
        const today = new Date(todayStr);
        const yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);
        const tomorrowStr = tomorrow.toISOString().split('T')[0];
        
        if (nextDateStr < todayStr) {
          nextWateringEl.textContent = `${nextDateStr} (é€¾æœŸ)`;
          statusText = 'å·²é€¾æœŸ';
        } else if (nextDateStr === yesterdayStr || nextDateStr === todayStr || nextDateStr === tomorrowStr) {
          // å‰ä¸€å¤©ã€ä»Šå¤©ã€åä¸€å¤©éƒ½ç®—ä½œéœ€è¦æµ‡æ°´
          if (nextDateStr === yesterdayStr) {
            nextWateringEl.textContent = `${nextDateStr} (æ˜¨å¤©)`;
          } else if (nextDateStr === todayStr) {
            nextWateringEl.textContent = `${nextDateStr} (ä»Šå¤©)`;
          } else {
            nextWateringEl.textContent = `${nextDateStr} (æ˜å¤©)`;
          }
          statusText = 'éœ€è¦æµ‡æ°´';
        } else {
          nextWateringEl.textContent = nextDateStr;
          statusText = 'æ­£å¸¸';
        }
      }
      
      areaStatusEl.textContent = statusText;
      areaStatusEl.className = 'text-sm font-medium';
      if (statusText === 'æ­£å¸¸') {
        areaStatusEl.classList.add('text-secondary');
      } else if (statusText === 'éœ€è¦æµ‡æ°´') {
        areaStatusEl.classList.add('text-warning');
      } else {
        areaStatusEl.classList.add('text-danger');
      }
      
      // æ›´æ–°åœ°å›¾åŒºåŸŸé¢œè‰²
      updateAreaColor(selectedArea, statusText);
      
      // æ›´æ–°æµ‡æ°´è®°å½•
      updateWateringRecords();
      
      // æ›´æ–°æµ‡æ°´é¢‘ç‡é€‰æ‹©
      wateringFrequencyEl.value = areaData.wateringFrequency;
      
      // æ·»åŠ æµ‡æ°´é¢‘ç‡å˜æ›´ç›‘å¬
      wateringFrequencyEl.onchange = function() {
        if (selectedArea) {
          greenAreas[selectedArea].wateringFrequency = this.value;
          updateAreaDetails();
          updateCalendar();
          
          // ä¿å­˜æ•°æ®
          saveData();
        }
      };
    }
    
    // æ›´æ–°åŒºåŸŸé¢œè‰²
    function updateAreaColor(areaName, status) {
      const path = document.getElementById(`area-${areaName}`);
      if (!path) {
        console.log(`âŒ æ‰¾ä¸åˆ°åŒºåŸŸè·¯å¾„: area-${areaName}`);
        return;
      }
      
      let fillColor, strokeColor;
      switch(status) {
        case 'æ­£å¸¸':
          fillColor = 'rgba(139, 195, 74, 0.4)';
          strokeColor = '#8BC34A';
          break;
        case 'éœ€è¦æµ‡æ°´':
          fillColor = 'rgba(255, 125, 0, 0.4)';
          strokeColor = '#FF7D00';
          break;
        case 'å·²é€¾æœŸ':
          fillColor = 'rgba(245, 63, 63, 0.4)';
          strokeColor = '#F53F3F';
          break;
        default:
          fillColor = 'rgba(139, 195, 74, 0.4)';
          strokeColor = '#8BC34A';
      }
      
      path.setAttribute('fill', fillColor);
      path.setAttribute('stroke', strokeColor);
      console.log(`âœ… åŒºåŸŸ ${areaName} é¢œè‰²å·²æ›´æ–°ä¸º: ${status} (${strokeColor})`);
    }
    
    // æ›´æ–°æµ‡æ°´è®°å½•ï¼ˆå¸¦åˆ†é¡µï¼‰
    function updateWateringRecords() {
      if (!selectedArea) return;
      
      const areaData = greenAreas[selectedArea];
      const records = areaData.records || [];
      
      // è®¡ç®—æ€»é¡µæ•°
      const totalPages = Math.max(1, Math.ceil(records.length / wateringPerPage));
      
      // æ›´æ–°åˆ†é¡µä¿¡æ¯
      wateringCurrentPage = Math.min(wateringCurrentPage, totalPages);
      wateringCurrentPageEl.textContent = wateringCurrentPage;
      wateringTotalPagesEl.textContent = totalPages;
      
      // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
      wateringPrevPageBtn.disabled = wateringCurrentPage === 1;
      wateringNextPageBtn.disabled = wateringCurrentPage === totalPages;
      
      // è·å–å½“å‰é¡µçš„è®°å½•
      const startIndex = (wateringCurrentPage - 1) * wateringPerPage;
      const endIndex = startIndex + wateringPerPage;
      const currentRecords = records.slice(startIndex, endIndex);
      
      // æ¸…ç©ºæµ‡æ°´è®°å½•å®¹å™¨
      wateringRecords.innerHTML = '';
      
      if (currentRecords.length === 0) {
        wateringRecords.innerHTML = '<div class="text-center py-4 text-gray-500 text-sm">æš‚æ— æµ‡æ°´è®°å½•</div>';
        wateringPagination.classList.add('hidden');
      } else {
        currentRecords.forEach(record => {
          const recordEl = document.createElement('div');
          recordEl.classList.add('bg-gray-50', 'rounded', 'p-2', 'border', 'border-gray-200');
          recordEl.innerHTML = `
            <div class="flex justify-between text-sm">
              <span class="font-medium">${record.date}</span>
              <span class="text-gray-500">${record.person || 'ç®¡ç†å‘˜'}</span>
              </div>
            <p class="text-xs text-gray-500 mt-1">${record.notes}</p>
          `;
          wateringRecords.appendChild(recordEl);
        });
        
        // æ˜¾ç¤ºåˆ†é¡µæ§ä»¶
        wateringPagination.classList.remove('hidden');
      }
      
      // ä¿å­˜æ•°æ®
      saveData();
    }
    
    // æµ‡æ°´è®°å½•ä¸Šä¸€é¡µ
    function goToWateringPrevPage() {
      if (wateringCurrentPage > 1) {
        wateringCurrentPage--;
        updateWateringRecords();
        // ä¿å­˜æ•°æ®
        saveData();
      }
    }
    
    // æµ‡æ°´è®°å½•ä¸‹ä¸€é¡µ
    function goToWateringNextPage() {
      const areaData = greenAreas[selectedArea];
      const records = areaData.records || [];
      const totalPages = Math.max(1, Math.ceil(records.length / wateringPerPage));
      
      if (wateringCurrentPage < totalPages) {
        wateringCurrentPage++;
        updateWateringRecords();
        // ä¿å­˜æ•°æ®
        saveData();
      }
    }

    // å¼€å§‹ç»˜åˆ¶
    drawAreaBtn.addEventListener('click', () => {
      // æ˜¾ç¤ºç»˜åˆ¶å¯†ç æ¨¡æ€æ¡†
      drawingPasswordModal.classList.remove('hidden');
      drawingPasswordEl.value = '';
      drawingPasswordErrorEl.classList.add('hidden');
    });

    // éªŒè¯ç»˜åˆ¶å¯†ç 
    function verifyDrawingPassword() {
      const password = drawingPasswordEl.value;
      
      if (password !== '654321') {
        drawingPasswordErrorEl.classList.remove('hidden');
        return;
      }
      
      // å¯†ç æ­£ç¡®ï¼Œè¿›å…¥ç»˜åˆ¶æ¨¡å¼
      isDrawing = true;
      drawingPoints = [];
      drawAreaBtn.classList.add('hidden');
      cancelDrawingBtn.classList.remove('hidden');
      confirmDrawingBtn.classList.remove('hidden');
      drawingStatus.classList.remove('hidden');
      schoolMap.classList.add('drawing-cursor');
      
      // å…³é—­æ¨¡æ€æ¡†
      drawingPasswordModal.classList.add('hidden');
    }

    // å–æ¶ˆç»˜åˆ¶
    cancelDrawingBtn.addEventListener('click', () => {
      isDrawing = false;
      drawingPoints = [];
      tempPath.setAttribute('d', '');
      tempPath.classList.add('hidden');
      drawAreaBtn.classList.remove('hidden');
      cancelDrawingBtn.classList.add('hidden');
      confirmDrawingBtn.classList.add('hidden');
      drawingStatus.classList.add('hidden');
      schoolMap.classList.remove('drawing-cursor');
    });

    // ç¡®è®¤ç»˜åˆ¶
    confirmDrawingBtn.addEventListener('click', () => {
      if (drawingPoints.length < 3) {
        alert('è‡³å°‘éœ€è¦ä¸‰ä¸ªç‚¹æ¥ç»˜åˆ¶åŒºåŸŸ');
        return;
      }
      
      // ç”Ÿæˆé—­åˆè·¯å¾„
      const path = `M${drawingPoints.map(point => `${point.x},${point.y}`).join(' L')} Z`;
      
      // æç¤ºç”¨æˆ·è¾“å…¥åŒºåŸŸåç§°
      let areaName = prompt('è¯·è¾“å…¥åŒºåŸŸåç§°ï¼ˆä¾‹å¦‚ï¼šå›¾ä¹¦é¦†å‰è‰åªï¼‰', `åŒºåŸŸ${nextAreaLetter.toUpperCase()}`);
      
      // å¦‚æœç”¨æˆ·å–æ¶ˆè¾“å…¥æˆ–è¾“å…¥ç©ºå€¼ï¼Œä½¿ç”¨é»˜è®¤åç§°
      if (areaName === null || areaName.trim() === '') {
        areaName = `åŒºåŸŸ${nextAreaLetter.toUpperCase()}`;
      }
      
      // æ£€æŸ¥åŒºåŸŸåç§°æ˜¯å¦å·²å­˜åœ¨
      if (greenAreas.hasOwnProperty(areaName)) {
        alert(`åŒºåŸŸåç§° "${areaName}" å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°`);
        return;
      }
      
      // æç¤ºç”¨æˆ·è¾“å…¥ä¸Šæ¬¡æµ‡æ°´æ—¶é—´
      const today = new Date().toISOString().split('T')[0];
      
      // åˆ›å»ºæ—¥æœŸé€‰æ‹©é¡µé¢
      const dateModal = document.createElement('div');
      dateModal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); display: flex; align-items: center;
        justify-content: center; z-index: 10000;
      `;
      
      // åˆ›å»ºæ—¥æœŸé€‰æ‹©å™¨å†…å®¹
      const datePickerContent = document.createElement('div');
      datePickerContent.style.cssText = `
        background: white; border-radius: 8px; padding: 30px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; width: 90%;
        text-align: center;
      `;
      
      // åˆ›å»ºæ—¥æœŸé€‰æ‹©å™¨HTML
      datePickerContent.innerHTML = `
        <div style="margin-bottom: 25px;">
          <h3 style="color: #333; margin-bottom: 10px; font-size: 18px;">è®¾ç½®ä¸Šæ¬¡æµ‡æ°´æ—¶é—´</h3>
          <p style="color: #666; font-size: 14px; margin-bottom: 20px;">è¯·é€‰æ‹©è¯¥åŒºåŸŸçš„ä¸Šæ¬¡æµ‡æ°´æ—¶é—´</p>
        </div>
        
        <div style="margin-bottom: 25px;">
          <label for="watering-date" style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">é€‰æ‹©æ—¥æœŸï¼š</label>
          <input type="date" id="watering-date" value="${today}" max="${today}" 
                 style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 6px; 
                        font-size: 16px; outline: none; transition: border-color 0.3s;">
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: center;">
          <button id="confirm-date-btn" 
                  style="padding: 12px 24px; background: #8b1e23; color: white; 
                         border: none; border-radius: 6px; cursor: pointer; font-size: 14px;
                         transition: background-color 0.3s; min-width: 80px;">
            ç¡®å®š
          </button>
          <button id="cancel-date-btn" 
                  style="padding: 12px 24px; background: #f3f4f6; color: #374151; 
                         border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; 
                         font-size: 14px; transition: background-color 0.3s; min-width: 80px;">
            å–æ¶ˆ
          </button>
        </div>
      `;
      
      dateModal.appendChild(datePickerContent);
      document.body.appendChild(dateModal);
      
      // è·å–æ—¥æœŸè¾“å…¥æ¡†å¹¶æ·»åŠ æ ·å¼
      const dateInputElement = dateModal.querySelector('#watering-date');
      dateInputElement.addEventListener('focus', () => {
        dateInputElement.style.borderColor = '#8b1e23';
      });
      dateInputElement.addEventListener('blur', () => {
        dateInputElement.style.borderColor = '#e5e7eb';
      });
      
      // æ·»åŠ æŒ‰é’®æ‚¬åœæ•ˆæœ
      const confirmBtn = dateModal.querySelector('#confirm-date-btn');
      const cancelBtn = dateModal.querySelector('#cancel-date-btn');
      
      confirmBtn.addEventListener('mouseenter', () => {
        confirmBtn.style.backgroundColor = '#6b1519';
      });
      confirmBtn.addEventListener('mouseleave', () => {
        confirmBtn.style.backgroundColor = '#8b1e23';
      });
      
      cancelBtn.addEventListener('mouseenter', () => {
        cancelBtn.style.backgroundColor = '#e5e7eb';
      });
      cancelBtn.addEventListener('mouseleave', () => {
        cancelBtn.style.backgroundColor = '#f3f4f6';
      });
      
      // ç»‘å®šäº‹ä»¶
      dateModal.querySelector('#confirm-date-btn').addEventListener('click', () => {
        const lastWateredDate = dateInputElement.value;
        if (!lastWateredDate) {
          alert('è¯·é€‰æ‹©ä¸Šæ¬¡æµ‡æ°´æ—¶é—´');
          return;
        }
        document.body.removeChild(dateModal);
        createNewArea(areaName, path, lastWateredDate);
      });
      
      dateModal.querySelector('#cancel-date-btn').addEventListener('click', () => {
        document.body.removeChild(dateModal);
        cancelDrawingBtn.click();
      });
      
      // å¦‚æœç”¨æˆ·ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨ï¼Œå–æ¶ˆæ“ä½œ
      dateModal.addEventListener('click', (e) => {
        if (e.target === dateModal) {
          document.body.removeChild(dateModal);
          cancelDrawingBtn.click();
        }
      });
      
      return; // æš‚åœæ‰§è¡Œï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥
    });
    
    // åˆ›å»ºæ–°åŒºåŸŸçš„å‡½æ•°
    function createNewArea(areaName, path, lastWateredDate) {
      // åˆ›å»ºæ–°åŒºåŸŸ
      greenAreas[areaName] = {
        lastWatered: lastWateredDate,
        wateringFrequency: "1", // é»˜è®¤æ¯æœˆ1æ¬¡
        path: path,
        records: []
      };
      
      // åœ¨SVGä¸­æ·»åŠ æ–°åŒºåŸŸ
      const newPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
      newPath.setAttribute("d", path);
      newPath.setAttribute("fill", "rgba(139, 195, 74, 0.4)");
      newPath.setAttribute("stroke", "#4CAF50");
      newPath.setAttribute("stroke-width", "2");
      newPath.setAttribute("class", "area-path");
      newPath.setAttribute("id", `area-${areaName}`);
      newPath.addEventListener('click', () => selectArea(areaName));
      schoolMap.insertBefore(newPath, tempPath);
      
      // æ›´æ–°åŒºåŸŸå­—æ¯
      nextAreaLetter = String.fromCharCode(nextAreaLetter.charCodeAt(0) + 1);
      
      // æ›´æ–°UI
      updateAreaButtons();
      selectArea(areaName);
      cancelDrawingBtn.click();
      updateCalendar();
      
      // ä¿å­˜æ•°æ®
      saveData();
    }

    // å¤„ç†é¼ æ ‡ç‚¹å‡»äº‹ä»¶ï¼ˆæ”¹è¿›åæ ‡å®šä½ï¼‰
    schoolMap.addEventListener('click', (e) => {
      if (!isDrawing) return;
      
      // ä½¿ç”¨SVGçš„åæ ‡è½¬æ¢è§£å†³åç§»é—®é¢˜
      const point = schoolMap.createSVGPoint();
      point.x = e.clientX;
      point.y = e.clientY;
      const svgPoint = point.matrixTransform(schoolMap.getScreenCTM().inverse());
      
      drawingPoints.push({ x: svgPoint.x, y: svgPoint.y });
      
      // æ›´æ–°ä¸´æ—¶è·¯å¾„
      const path = `M${drawingPoints.map(point => `${point.x},${point.y}`).join(' L')}`;
      tempPath.setAttribute('d', path);
      tempPath.classList.remove('hidden');
    });

    // åˆ é™¤åŒºåŸŸ
    deleteAreaBtn.addEventListener('click', () => {
      if (!selectedArea) {
        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåŒºåŸŸ');
        return;
      }
      
      // æ˜¾ç¤ºåˆ é™¤ç¡®è®¤æ¨¡æ€æ¡†
      deleteAreaNameEl.textContent = selectedArea;
      deletePasswordEl.value = '';
      passwordErrorEl.classList.add('hidden');
      deleteModal.classList.remove('hidden');
    });

    // æ‰§è¡Œåˆ é™¤æ“ä½œ
    function performDeleteArea() {
      const password = deletePasswordEl.value;
      
      // éªŒè¯å¯†ç 
      if (password !== '123456') {
        passwordErrorEl.classList.remove('hidden');
        return;
      }
      
      // ä»SVGä¸­åˆ é™¤
      const pathToRemove = document.getElementById(`area-${selectedArea}`);
      if (pathToRemove) {
        pathToRemove.remove();
      }
      
      // ä»æ•°æ®ä¸­åˆ é™¤
      delete greenAreas[selectedArea];
      
      // æ›´æ–°UI
      selectedArea = Object.keys(greenAreas).length > 0 ? Object.keys(greenAreas)[0] : null;
      updateAreaButtons();
      updateAreaDetails();
      updateCalendar();
      
      // å…³é—­æ¨¡æ€æ¡†
      deleteModal.classList.add('hidden');
      
      // ä¿å­˜æ•°æ®
      saveData();
    }

    // è®°å½•æµ‡æ°´
    recordWateringBtn.addEventListener('click', () => {
      if (!selectedArea) {
        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåŒºåŸŸ');
        return;
      }
      
      wateringModal.classList.remove('hidden');
      modalAreaEl.value = selectedArea;
      
      // è®¾ç½®å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      modalDateEl.value = `${year}-${month}-${day} ${hours}:${minutes}`;
      
      modalPersonEl.value = '';
      modalNotesEl.value = '';
      
      // é‡ç½®å€’è®¡æ—¶çŠ¶æ€
      countdownTip.classList.add('hidden');
      submitWateringBtn.disabled = false;
      submitWateringBtn.textContent = 'ä¿å­˜è®°å½•';
    });

    // å…³é—­æ¨¡æ€æ¡†
    closeModalBtn.addEventListener('click', () => {
      wateringModal.classList.add('hidden');
      clearCountdown(); // æ¸…é™¤å€’è®¡æ—¶
    });

    cancelWateringBtn.addEventListener('click', () => {
      wateringModal.classList.add('hidden');
      clearCountdown(); // æ¸…é™¤å€’è®¡æ—¶
    });

    // æ¸…é™¤å€’è®¡æ—¶
    function clearCountdown() {
      if (countdownTimer) {
        clearInterval(countdownTimer);
        countdownTimer = null;
      }
      countdownTip.classList.add('hidden');
    }
    
    // ä¿å­˜æµ‡æ°´è®°å½•ï¼ˆæ·»åŠ å€’è®¡æ—¶åŠŸèƒ½ï¼‰
    wateringForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const area = modalAreaEl.value;
      const date = modalDateEl.value;
      const person = modalPersonEl.value.trim();
      const notes = modalNotesEl.value.trim();
      
      // éªŒè¯è´Ÿè´£äººå’Œå¤‡æ³¨
      if (person === '') {
        alert('è¯·è¾“å…¥è´Ÿè´£äººå§“å');
        modalPersonEl.focus();
        return;
      }
      
      if (notes === '') {
        alert('è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯');
        modalNotesEl.focus();
        return;
      }
      
      // ç¦ç”¨æäº¤æŒ‰é’®
      submitWateringBtn.disabled = true;
      submitWateringBtn.textContent = 'æäº¤ä¸­...';
      
      // æ˜¾ç¤ºå€’è®¡æ—¶æç¤º
      countdownTip.classList.remove('hidden');
      
      let seconds = 3;
      countdownSeconds.textContent = seconds;
      
      // å¼€å§‹å€’è®¡æ—¶
      countdownTimer = setInterval(() => {
        seconds--;
        countdownSeconds.textContent = seconds;
        
        if (seconds <= 0) {
          clearInterval(countdownTimer);
          countdownTimer = null;
          
          // æ›´æ–°æµ‡æ°´è®°å½•
          greenAreas[area].lastWatered = date.split(' ')[0];
          greenAreas[area].records.unshift({ date, person, notes });
          
          // æ›´æ–°UI
          updateAreaDetails();
          updateCalendar();
          wateringModal.classList.add('hidden');
          
          // ä¿å­˜æ•°æ®
          saveData();
          
          alert('æµ‡æ°´è®°å½•å·²æˆåŠŸä¿å­˜ï¼');
        }
      }, 1000);
    });

    // ç”Ÿæˆæ‰€æœ‰åŒºåŸŸä»»åŠ¡ï¼šæ˜¾ç¤ºä»Šå¤©åˆ°æœªæ¥30å¤©çš„æ‰€æœ‰ä»»åŠ¡ï¼Œå¹¶åŒ…å«æ‰€æœ‰å·²é€¾æœŸä»»åŠ¡
    function generateAllTasks() {
      const now = new Date();
      const todayStr = now.toISOString().split('T')[0];
      const tasks = [];

      if (Object.keys(greenAreas).length === 0) {
        return tasks;
      }

      Object.entries(greenAreas).forEach(([area, data]) => {
        const frequency = parseInt(data.wateringFrequency);
        if (frequency > 0) {
          const lastWatered = new Date(data.lastWatered);
          const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
          const interval = Math.round(daysInMonth / frequency);

          // ä»ä¸‹ä¸€ä¸ªå‘¨æœŸç‚¹å¼€å§‹ï¼Œç›´åˆ°æœªæ¥30å¤©
          let taskDate = new Date(lastWatered.getTime() + interval * 24 * 60 * 60 * 1000);
          const endDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);

          while (taskDate <= endDate) {
            const taskDateStr = taskDate.toISOString().split('T')[0];
            
            // è®¡ç®—å‰ä¸€å¤©å’Œåä¸€å¤©çš„æ—¥æœŸ
            const today = new Date(todayStr);
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            if (taskDateStr < todayStr) {
              tasks.push({
                date: taskDateStr,
                area: area,
                task: "æµ‡æ°´",
                status: "é€¾æœŸ"
              });
            } else if (taskDateStr === yesterdayStr || taskDateStr === todayStr || taskDateStr === tomorrowStr) {
              // å‰ä¸€å¤©ã€ä»Šå¤©ã€åä¸€å¤©éƒ½ç®—ä½œéœ€è¦æµ‡æ°´
              tasks.push({
                date: taskDateStr,
                area: area,
                task: "æµ‡æ°´",
                status: "éœ€è¦æµ‡æ°´"
              });
            } else if (taskDateStr > todayStr && taskDate <= endDate) {
              tasks.push({
                date: taskDateStr,
                area: area,
                task: "æµ‡æ°´",
                status: "å¾…å®Œæˆ"
              });
            }
            // ä¸‹ä¸€ä¸ªå‘¨æœŸ
            taskDate = new Date(taskDate.getTime() + interval * 24 * 60 * 60 * 1000);
          }
        }
      });

      // æŒ‰æ—¥æœŸå‡åºæ’åˆ—
      tasks.sort((a, b) => new Date(a.date) - new Date(b.date));
      return tasks;
    }

    // æ›´æ–°ä»»åŠ¡æ—¥å†
    function updateCalendar() {
      // ç”Ÿæˆæ‰€æœ‰ä»»åŠ¡
      allTasks = generateAllTasks();
      
      // è®¡ç®—æ€»é¡µæ•°
      const totalPages = Math.max(1, Math.ceil(allTasks.length / tasksPerPage));
      
      // æ›´æ–°åˆ†é¡µä¿¡æ¯
      currentPage = Math.min(currentPage, totalPages);
      currentPageEl.textContent = currentPage;
      totalPagesEl.textContent = totalPages;
      
      // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages;
      
      // è·å–å½“å‰é¡µçš„ä»»åŠ¡
      const startIndex = (currentPage - 1) * tasksPerPage;
      const endIndex = startIndex + tasksPerPage;
      const currentTasks = allTasks.slice(startIndex, endIndex);
      
      // æ¸…ç©ºæ—¥å†è¡¨æ ¼
      calendarBody.innerHTML = '';
      
      if (currentTasks.length === 0) {
        calendarBody.innerHTML = `
          <tr>
            <td colspan="4" class="px-3 py-4 text-center text-sm text-gray-500">æš‚æ— ä»»åŠ¡</td>
          </tr>
        `;
        return;
      }
      
      // æ˜¾ç¤ºå½“å‰é¡µçš„ä»»åŠ¡
      currentTasks.forEach(task => {
        const row = document.createElement('tr');
        let statusClass = "text-gray-500";
        if (task.status === "é€¾æœŸ") statusClass = "text-danger";
        if (task.status === "éœ€è¦æµ‡æ°´") statusClass = "text-warning";
        
        row.innerHTML = `
          <td class="px-3 py-2 text-sm">${task.date}</td>
          <td class="px-3 py-2 text-sm font-medium">${task.area}</td>
          <td class="px-3 py-2 text-sm">${task.task}</td>
          <td class="px-3 py-2 text-sm ${statusClass}">${task.status}</td>
        `;
        calendarBody.appendChild(row);
      });
      
      // ä¿å­˜æ•°æ®
      saveData();
    }

    // ä¸Šä¸€é¡µ
    function goToPrevPage() {
      if (currentPage > 1) {
        currentPage--;
        updateCalendar();
      }
    }

    // ä¸‹ä¸€é¡µ
    function goToNextPage() {
      const totalPages = Math.ceil(allTasks.length / tasksPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        updateCalendar();
      }
    }

    // åˆ·æ–°çŠ¶æ€
    refreshBtn.addEventListener('click', () => {
      // æ¸…é™¤æœ¬åœ°å­˜å‚¨
      if (window.testStorage) {
        testStorage.clearAllData();
      }
      
      // ä»JSONæ–‡ä»¶é‡æ–°åŠ è½½æ•°æ®
      loadFromJsonFile().then(success => {
        if (success) {
          // é‡æ–°ç»˜åˆ¶æ‰€æœ‰åŒºåŸŸ
          redrawAllAreas();
          // æ›´æ–°ç•Œé¢
          updateAreaButtons();
          updateCalendar();
          alert('âœ… çŠ¶æ€å·²åˆ·æ–°ï¼å·²ä» green-area.json æ–‡ä»¶é‡æ–°åŠ è½½æ•°æ®å¹¶ç«‹å³åº”ç”¨ã€‚');
        } else {
          alert('âŒ åˆ·æ–°å¤±è´¥ï¼è¯·æ£€æŸ¥ green-area.json æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ã€‚');
        }
      });
    });
    
    // åŒæ­¥æŒ‰é’®äº‹ä»¶ç›‘å¬
    const syncBtn = document.getElementById('sync-btn');
    if (syncBtn) {
      syncBtn.addEventListener('click', () => {
        // åˆ›å»ºç®€å•çš„åŒæ­¥æ¨¡æ€æ¡†
        const syncModal = document.createElement('div');
        syncModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        syncModal.innerHTML = `
          <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">
                  <i class="fa fa-exchange mr-2 text-primary"></i>æ•°æ®åŒæ­¥
                </h3>
                <button id="close-sync-modal" class="text-gray-400 hover:text-gray-600">
                  <i class="fa fa-times"></i>
                </button>
              </div>
              
              <div class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                  <button id="export-sync-btn" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                    <i class="fa fa-download mr-2"></i>å¯¼å‡ºæ•°æ®
                  </button>
                  <button id="import-sync-btn" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                    <i class="fa fa-upload mr-2"></i>å¯¼å…¥æ•°æ®
                  </button>
                </div>
                
                <input type="file" id="sync-import-file" accept=".json" class="hidden">
                
                <div id="sync-status" class="text-sm text-gray-600">
                  ç‚¹å‡»æŒ‰é’®è¿›è¡Œæ•°æ®åŒæ­¥æ“ä½œ
                </div>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(syncModal);
        
        // å…³é—­æŒ‰é’®äº‹ä»¶
        const closeBtn = syncModal.querySelector('#close-sync-modal');
        closeBtn.addEventListener('click', () => {
          syncModal.remove();
        });
        
        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        syncModal.addEventListener('click', (e) => {
          if (e.target === syncModal) {
            syncModal.remove();
          }
        });
        
        // å¯¼å‡ºæŒ‰é’®äº‹ä»¶
        const exportBtn = syncModal.querySelector('#export-sync-btn');
        exportBtn.addEventListener('click', () => {
          try {
            const exportData = {
              greenAreas: greenAreas,
              selectedArea: selectedArea,
              nextAreaLetter: nextAreaLetter,
              currentPage: currentPage,
              wateringCurrentPage: wateringCurrentPage,
              exportTime: new Date().toISOString(),
              version: '1.0'
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç»¿åŒ–æ•°æ®_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            syncModal.querySelector('#sync-status').innerHTML = '<span class="text-green-600">âœ… æ•°æ®å¯¼å‡ºæˆåŠŸï¼</span>';
          } catch (error) {
            syncModal.querySelector('#sync-status').innerHTML = `<span class="text-red-600">âŒ å¯¼å‡ºå¤±è´¥: ${error.message}</span>`;
          }
        });
        
        // å¯¼å…¥æŒ‰é’®äº‹ä»¶
        const importBtn = syncModal.querySelector('#import-sync-btn');
        importBtn.addEventListener('click', () => {
          syncModal.querySelector('#sync-import-file').click();
        });
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        const fileInput = syncModal.querySelector('#sync-import-file');
        fileInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
              try {
                const importedData = JSON.parse(e.target.result);
                
                if (!importedData.greenAreas) {
                  throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                }
                
                // æ›´æ–°æ•°æ®
                greenAreas = importedData.greenAreas || {};
                selectedArea = importedData.selectedArea || '';
                nextAreaLetter = importedData.nextAreaLetter || 'A';
                currentPage = importedData.currentPage || 1;
                wateringCurrentPage = importedData.wateringCurrentPage || 1;
                
                // ä¿å­˜æ•°æ®
                saveData();
                
                // é‡æ–°ç»˜åˆ¶ç•Œé¢
                redrawAllAreas();
                updateAreaButtons();
                updateWateringRecords();
                updateCalendar();
                
                syncModal.querySelector('#sync-status').innerHTML = '<span class="text-green-600">âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼æ–°æ•°æ®å·²ç«‹å³åº”ç”¨ã€‚</span>';
                
                // å…³é—­æ¨¡æ€æ¡†
                setTimeout(() => {
                  syncModal.remove();
                }, 2000);
                
              } catch (error) {
                syncModal.querySelector('#sync-status').innerHTML = `<span class="text-red-600">âŒ å¯¼å…¥å¤±è´¥: ${error.message}</span>`;
              }
            };
            reader.readAsText(file);
            e.target.value = '';
          }
        });
      });
    }
    
    // æ·»åŠ æ•°æ®é‡ç½®åŠŸèƒ½ï¼ˆç”¨äºè°ƒè¯•ï¼‰
    function resetAllData() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å¹¶é‡æ–°å¼€å§‹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        try {
          // æ¸…é™¤localStorage
          Object.values(STORAGE_KEYS).forEach(key => {
            localStorage.removeItem(key);
          });
          
          // æ¸…é™¤sessionStorageå¤‡ä»½
          sessionStorage.removeItem('greening_backup');
          
          // é‡ç½®å˜é‡
          greenAreas = {};
          selectedArea = null;
          nextAreaLetter = 'a';
          currentPage = 1;
          wateringCurrentPage = 1;
          
          // é‡æ–°åˆå§‹åŒ–
          location.reload();
        } catch (error) {
          console.error('é‡ç½®æ•°æ®å¤±è´¥:', error);
        }
      }
    }
    
    // æ·»åŠ è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º
    function showDebugInfo() {
      const debugInfo = {
        'localStorageæ•°æ®': {
          'ç»¿åŒ–åŒºåŸŸ': localStorage.getItem(STORAGE_KEYS.GREEN_AREAS) ? 'å·²ä¿å­˜' : 'æœªä¿å­˜',
          'é€‰ä¸­åŒºåŸŸ': localStorage.getItem(STORAGE_KEYS.SELECTED_AREA) || 'æ— ',
          'åŒºåŸŸæ•°é‡': Object.keys(greenAreas).length,
          'æ•°æ®å¤§å°': localStorage.getItem(STORAGE_KEYS.GREEN_AREAS) ? localStorage.getItem(STORAGE_KEYS.GREEN_AREAS).length : 0
        },
        'å½“å‰å†…å­˜æ•°æ®': {
          'åŒºåŸŸåˆ—è¡¨': Object.keys(greenAreas),
          'é€‰ä¸­åŒºåŸŸ': selectedArea,
          'åŒºåŸŸå­—æ¯': nextAreaLetter,
          'å½“å‰é¡µ': currentPage,
          'æµ‡æ°´è®°å½•é¡µ': wateringCurrentPage
        },
        'å¤‡ä»½æ•°æ®': {
          'sessionStorageå¤‡ä»½': sessionStorage.getItem('greening_backup') ? 'å·²å¤‡ä»½' : 'æœªå¤‡ä»½',
          'å¤‡ä»½å¤§å°': sessionStorage.getItem('greening_backup') ? sessionStorage.getItem('greening_backup').length : 0
        },
        'æ•°æ®å®Œæ•´æ€§': {
          'greenAreasç±»å‹': typeof greenAreas,
          'selectedAreaç±»å‹': typeof selectedArea,
          'nextAreaLetterç±»å‹': typeof nextAreaLetter,
          'currentPageç±»å‹': typeof currentPage,
          'wateringCurrentPageç±»å‹': typeof wateringCurrentPage
        }
      };
      
      console.log('è°ƒè¯•ä¿¡æ¯:', debugInfo);
      alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŒ‰F12æŸ¥çœ‹');
    }
    
    // æ·»åŠ æ•°æ®æ¢å¤æµ‹è¯•åŠŸèƒ½
    function testDataRecovery() {
      try {
        // ä¿å­˜å½“å‰çŠ¶æ€
        const currentState = {
          greenAreas: {...greenAreas},
          selectedArea: selectedArea,
          nextAreaLetter: nextAreaLetter,
          currentPage: currentPage,
          wateringCurrentPage: wateringCurrentPage
        };
        
        // æ¸…é™¤localStorage
        Object.values(STORAGE_KEYS).forEach(key => {
          localStorage.removeItem(key);
        });
        
        // é‡æ–°åŠ è½½æ•°æ®
        const loadResult = loadData();
        
        // æ¢å¤åŸå§‹çŠ¶æ€
        greenAreas = currentState.greenAreas;
        selectedArea = currentState.selectedArea;
        nextAreaLetter = currentState.nextAreaLetter;
        currentPage = currentState.currentPage;
        wateringCurrentPage = currentState.wateringCurrentPage;
        
        // ä¿å­˜æ•°æ®
        saveData();
        
        const testResult = {
          'åŠ è½½ç»“æœ': loadResult,
          'æ•°æ®æ¢å¤': 'æµ‹è¯•å®Œæˆ',
          'å½“å‰çŠ¶æ€': 'å·²æ¢å¤'
        };
        
        console.log('æ•°æ®æ¢å¤æµ‹è¯•ç»“æœ:', testResult);
        alert('æ•°æ®æ¢å¤æµ‹è¯•å®Œæˆï¼Œç»“æœå·²è¾“å‡ºåˆ°æ§åˆ¶å°');
        
      } catch (error) {
        console.error('æ•°æ®æ¢å¤æµ‹è¯•å¤±è´¥:', error);
        alert('æ•°æ®æ¢å¤æµ‹è¯•å¤±è´¥: ' + error.message);
      }
    }
    
    // ä¸ºè°ƒè¯•æ·»åŠ é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      // Ctrl+Shift+R é‡ç½®æ•°æ®
      if (e.ctrlKey && e.shiftKey && e.key === 'R') {
        e.preventDefault();
        resetAllData();
      }
      // Ctrl+Shift+D æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
      if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        e.preventDefault();
        showDebugInfo();
      }
      // Ctrl+Shift+T æµ‹è¯•æ•°æ®æ¢å¤
      if (e.ctrlKey && e.shiftKey && e.key === 'T') {
        e.preventDefault();
        testDataRecovery();
      }
    });

    // é¡µé¢å¸è½½å‰ä¿å­˜æ•°æ®
    window.addEventListener('beforeunload', () => {
      saveData();
    });

    // å®šæœŸè‡ªåŠ¨ä¿å­˜æ•°æ®ï¼ˆæ¯10ç§’ï¼Œæ›´é¢‘ç¹ï¼‰
    setInterval(() => {
      saveData();
    }, 10000);
    
    // æ·»åŠ è°ƒè¯•å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      // Ctrl+Shift+D: æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
      if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        e.preventDefault();
        console.log('=== è°ƒè¯•ä¿¡æ¯ ===');
        console.log('å½“å‰æ•°æ®çŠ¶æ€:', {
          greenAreas: Object.keys(greenAreas),
          selectedArea: selectedArea,
          nextAreaLetter: nextAreaLetter,
          currentPage: currentPage,
          wateringCurrentPage: wateringCurrentPage
        });
        
        console.log('localStorageçŠ¶æ€:', {
          areas: localStorage.getItem('campus_greening_areas') ? 'å·²ä¿å­˜' : 'æœªä¿å­˜',
          selected: localStorage.getItem('campus_greening_selected_area') || 'æ— ',
          letter: localStorage.getItem('campus_greening_next_area_letter') || 'æ— ',
          page: localStorage.getItem('campus_greening_current_page') || 'æ— ',
          wateringPage: localStorage.getItem('campus_greening_watering_current_page') || 'æ— '
        });
        
        if (window.cloudStorage) {
          const status = cloudStorage.getStorageStatus();
          console.log('cloudStorageçŠ¶æ€:', status);
        }
        
        alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ŒæŒ‰F12æŸ¥çœ‹');
      }
      
      // Ctrl+Shift+S: æ‰‹åŠ¨ä¿å­˜æ•°æ®
      if (e.ctrlKey && e.shiftKey && e.key === 'S') {
        e.preventDefault();
        saveData();
        alert('æ•°æ®å·²æ‰‹åŠ¨ä¿å­˜');
      }
    });
    
    // æ·»åŠ æ•°æ®å¤‡ä»½åŠŸèƒ½
    function backupData() {
      try {
        const backupData = {
          greenAreas: greenAreas,
          selectedArea: selectedArea,
          nextAreaLetter: nextAreaLetter,
          currentPage: currentPage,
          wateringCurrentPage: wateringCurrentPage,
          timestamp: new Date().toISOString()
        };
        
        // ä¿å­˜åˆ°sessionStorageä½œä¸ºå¤‡ä»½
        sessionStorage.setItem('greening_backup', JSON.stringify(backupData));
        console.log('æ•°æ®å·²å¤‡ä»½åˆ°sessionStorage');
      } catch (error) {
        console.error('å¤‡ä»½æ•°æ®å¤±è´¥:', error);
      }
    }
    
    // ä»å¤‡ä»½æ¢å¤æ•°æ®
    function restoreFromBackup() {
      try {
        const backupData = sessionStorage.getItem('greening_backup');
        if (backupData) {
          const data = JSON.parse(backupData);
          greenAreas = data.greenAreas || {};
          selectedArea = data.selectedArea || null;
          nextAreaLetter = data.nextAreaLetter || 'a';
          currentPage = data.currentPage || 1;
          wateringCurrentPage = data.wateringCurrentPage || 1;
          
          console.log('ä»å¤‡ä»½æ¢å¤æ•°æ®æˆåŠŸ');
          return true;
        }
      } catch (error) {
        console.error('ä»å¤‡ä»½æ¢å¤æ•°æ®å¤±è´¥:', error);
      }
      return false;
    }
    

    
    // å®šæœŸå¤‡ä»½æ•°æ®ï¼ˆæ¯60ç§’ï¼‰
    setInterval(() => {
      backupData();
    }, 60000);
    
    // ===== ä¿å­˜åŠŸèƒ½éªŒè¯æ€»ç»“ =====
    // 
    // âœ… æ‰€æœ‰æ•°æ®ä¿®æ”¹æ“ä½œéƒ½å·²é…ç½®ä¿å­˜ç‚¹ï¼š
    // 1. åŒºåŸŸé€‰æ‹© (selectArea) -> saveData()
    // 2. æµ‡æ°´é¢‘ç‡ä¿®æ”¹ (wateringFrequencyEl.onchange) -> saveData()
    // 3. æµ‡æ°´è®°å½•åˆ†é¡µ (goToWateringPrevPage/goToWateringNextPage) -> saveData()
    // 4. æ–°å¢åŒºåŸŸ (confirmDrawingBtn) -> saveData()
    // 5. åˆ é™¤åŒºåŸŸ (performDeleteArea) -> saveData()
    // 6. è®°å½•æµ‡æ°´ (wateringForm.submit) -> saveData()
    // 7. ä»»åŠ¡æ—¥å†æ›´æ–° (updateCalendar) -> saveData()
    // 8. æµ‡æ°´è®°å½•æ›´æ–° (updateWateringRecords) -> saveData()
    // 9. åŒºåŸŸæŒ‰é’®æ›´æ–° (updateAreaButtons) -> saveData()
    // 10. è‡ªåŠ¨ä¿å­˜ (setInterval) -> saveData()
    // 11. é¡µé¢å¸è½½ (beforeunload) -> saveData()
    // 12. æ•°æ®å¤‡ä»½ (backupData) -> sessionStorage
    //
    // âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯ï¼š
    // - ä¿å­˜å‰éªŒè¯æ•°æ®æ ¼å¼
    // - ä¿å­˜åéªŒè¯ä¿å­˜ç»“æœ
    // - ä¿å­˜å¤±è´¥æ—¶è‡ªåŠ¨å¤‡ä»½
    //
    // âœ… æ•°æ®æ¢å¤æœºåˆ¶ï¼š
    // - localStorage ä¸»å­˜å‚¨
    // - sessionStorage å¤‡ä»½å­˜å‚¨
    // - é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ¢å¤
    // - æ•°æ®æŸåæ—¶ä»å¤‡ä»½æ¢å¤
    //
    // âœ… è°ƒè¯•å·¥å…·ï¼š
    // - Ctrl+Shift+D: æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
    // - Ctrl+Shift+R: é‡ç½®æ‰€æœ‰æ•°æ®
    // - Ctrl+Shift+T: æµ‹è¯•æ•°æ®æ¢å¤
    //
    // âœ… ä¿å­˜é¢‘ç‡ï¼š
    // - å®æ—¶ä¿å­˜ï¼šæ¯æ¬¡æ•°æ®ä¿®æ”¹
    // - å®šæœŸä¿å­˜ï¼šæ¯30ç§’è‡ªåŠ¨ä¿å­˜
    // - å®šæœŸå¤‡ä»½ï¼šæ¯60ç§’å¤‡ä»½åˆ°sessionStorage
    // - é¡µé¢å¸è½½ï¼šbeforeunloadäº‹ä»¶ä¿å­˜
    //
    // æ•°æ®ä¿å­˜åŠŸèƒ½éªŒè¯å®Œæˆ
    // ================================
    
    // ===== BUGæ£€æŸ¥æŠ¥å‘Š =====
    //
    // âœ… è¯­æ³•æ£€æŸ¥ï¼š
    // - æ‰€æœ‰å‡½æ•°å®šä¹‰æ­£ç¡®
    // - æ‰€æœ‰å˜é‡å£°æ˜æ­£ç¡®
    // - æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨æ­£ç¡®ç»‘å®š
    // - æ²¡æœ‰é‡å¤çš„å‡½æ•°å®šä¹‰
    //
    // âœ… é”™è¯¯å¤„ç†ï¼š
    // - æ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½æœ‰try-catch
    // - æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½æœ‰éªŒè¯
    // - æ‰€æœ‰DOMæ“ä½œéƒ½æœ‰nullæ£€æŸ¥
    //
    // âœ… å†…å­˜ç®¡ç†ï¼š
    // - äº‹ä»¶ç›‘å¬å™¨æ­£ç¡®ç§»é™¤
    // - å®šæ—¶å™¨æ­£ç¡®æ¸…ç†
    // - æ¨¡æ€æ¡†æ­£ç¡®å…³é—­
    //
    // âœ… æ•°æ®ä¸€è‡´æ€§ï¼š
    // - æ‰€æœ‰æ•°æ®ä¿®æ”¹éƒ½æœ‰å¯¹åº”çš„ä¿å­˜
    // - æ•°æ®æ ¼å¼éªŒè¯å®Œæ•´
    // - å¤‡ä»½å’Œæ¢å¤æœºåˆ¶å®Œå–„
    //
    // âœ… ç”¨æˆ·ä½“éªŒï¼š
    // - æ‰€æœ‰æ“ä½œéƒ½æœ‰ç”¨æˆ·åé¦ˆ
    // - é”™è¯¯ä¿¡æ¯æ¸…æ™°æ˜ç¡®
    // - åŠ è½½çŠ¶æ€æ­£ç¡®æ˜¾ç¤º
    //
    // BUGæ£€æŸ¥å®Œæˆ - æœªå‘ç°ä¸¥é‡é—®é¢˜ âœ…
    // ================================
    
    // æ˜¾ç¤ºé€šçŸ¥
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded shadow-lg ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        type === 'warning' ? 'bg-yellow-500 text-white' :
        'bg-blue-500 text-white'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    // æ£€æŸ¥å­˜å‚¨ç³»ç»Ÿåˆå§‹åŒ–
    console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
    console.log('testStorageçŠ¶æ€:', window.testStorage);
    if (window.testStorage) {
      console.log('âœ… å­˜å‚¨ç³»ç»Ÿå·²åˆå§‹åŒ–');
    } else {
      console.error('âŒ å­˜å‚¨ç³»ç»Ÿæœªåˆå§‹åŒ–');
    }
    
    // æ•°æ®åŒæ­¥åŠŸèƒ½é›†æˆå®Œæˆ âœ…
    // ================================
  </script>
</body>
</html>